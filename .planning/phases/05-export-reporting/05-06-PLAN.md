---
phase: 05-export-reporting
plan: 06
type: execute
wave: 4
depends_on: ["05-02", "05-03", "05-04", "05-05"]
files_modified:
  - src/export/export-orchestrator.ts
  - src/export/index.ts
  - src/index.ts
  - tests/export/export.test.ts
autonomous: true

must_haves:
  truths:
    - "Single exportDesignDNA function generates all exports in one call"
    - "All export files written to .uidna/exports/ directory structure"
    - "Export module integrated into main package barrel"
    - "Unit tests verify all export generators produce valid output"
  artifacts:
    - path: "src/export/export-orchestrator.ts"
      provides: "Top-level export orchestrator"
      exports: ["exportDesignDNA", "ExportResult"]
    - path: "tests/export/export.test.ts"
      provides: "Unit tests for all export generators"
    - path: "src/index.ts"
      provides: "Updated main barrel with Phase 5 exports"
  key_links:
    - from: "src/export/export-orchestrator.ts"
      to: "src/export/formatters/index.ts"
      via: "Calls all format generators"
      pattern: "import.*generate"
    - from: "src/export/export-orchestrator.ts"
      to: "src/export/reports/index.ts"
      via: "Calls report generators"
      pattern: "import.*generate.*Report"
    - from: "src/export/export-orchestrator.ts"
      to: "src/export/stubs/index.ts"
      via: "Calls stub generator"
      pattern: "import.*generateAllStubs"
    - from: "src/index.ts"
      to: "src/export/index.ts"
      via: "Phase 5 barrel integration"
      pattern: "export.*from.*export"
---

<objective>
Create the export orchestrator that ties all generators together, integrate into main package, and write unit tests.

Purpose: The orchestrator provides a single `exportDesignDNA()` function that generates all export files (3 formats, 5 JSON files, component stubs, 2 reports) and writes them to disk. Unit tests verify each generator produces correct output structure using fixture data. The export module is integrated into the main package barrel for external consumption.

Output: `src/export/export-orchestrator.ts`, `tests/export/export.test.ts`, updated `src/index.ts`.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-export-reporting/05-RESEARCH.md
@.planning/phases/05-export-reporting/05-CONTEXT.md
@.planning/phases/05-export-reporting/05-01-SUMMARY.md
@.planning/phases/05-export-reporting/05-02-SUMMARY.md
@.planning/phases/05-export-reporting/05-03-SUMMARY.md
@.planning/phases/05-export-reporting/05-04-SUMMARY.md
@.planning/phases/05-export-reporting/05-05-SUMMARY.md
@src/types/synthesis.ts
@src/types/evidence.ts
@src/types/components.ts
@src/types/patterns.ts
@src/types/content-style.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create export orchestrator and integrate into main barrel</name>
  <files>
    src/export/export-orchestrator.ts
    src/export/index.ts
    src/index.ts
  </files>
  <action>
1. Create `src/export/export-orchestrator.ts`:

**Types:**
```typescript
interface ExportInput {
  tokens: NormalizationResult;
  components: AggregatedComponent[];
  patterns: StoredPattern[];
  contentStyle: ContentStyleResult;
  evidenceIndex: EvidenceIndex;
  metadata: {
    sourceUrl: string;
    crawlDate: string;
    totalPages: number;
  };
}

interface ExportResult {
  files: Map<string, string>;  // relative path -> content
  summary: {
    totalFiles: number;
    formats: string[];
    jsonExports: string[];
    stubs: string[];
    reports: string[];
  };
}
```

**Main function:**
`async exportDesignDNA(input: ExportInput, outputDir?: string): Promise<ExportResult>`

1. Generate all export files by calling each generator:
   - `generateCSSCustomProperties(input.tokens)` -> `formats/tokens.css`
   - `generateTailwindConfig(input.tokens)` -> `formats/tailwind.config.js`
   - `generateFigmaTokens(input.tokens)` -> `formats/figma-tokens.json`
   - `generateTokensJSON(input.tokens)` -> `tokens.json`
   - `generateComponentsJSON(input.components)` -> `components.json`
   - `generatePatternsJSON(input.patterns)` -> `patterns.json`
   - `generateContentStyleJSON(input.contentStyle)` -> `content_style.json`
   - `generateEvidenceIndexJSON(input.evidenceIndex)` -> `evidence_index.json`
   - `generateAllStubs(input.components, input.tokens)` -> `stubs/[type].html` for each
   - `generateBrandDNAReport(...)` -> `brand-dna-report.md`
   - `generateContentStyleGuide(input.contentStyle, input.metadata)` -> `content-style-guide.md`

2. Collect all file contents into the result Map.

3. If `outputDir` is provided, write all files to disk:
   - Use `fs-extra`'s `ensureDir` and `outputFile` for safe writes
   - Default dir: `.uidna/exports/`
   - Directory structure:
     ```
     .uidna/exports/
     ├── formats/
     │   ├── tokens.css
     │   ├── tailwind.config.js
     │   └── figma-tokens.json
     ├── stubs/
     │   ├── button.html
     │   ├── card.html
     │   └── ...
     ├── tokens.json
     ├── components.json
     ├── patterns.json
     ├── content_style.json
     ├── evidence_index.json
     ├── brand-dna-report.md
     └── content-style-guide.md
     ```

4. Return ExportResult with file map and summary.

**Also export a helper:**
`generateExportSummary(result: ExportResult): string` — Returns a human-readable summary of what was exported (file count, format list, component stubs generated). Useful for CLI output in Phase 6.

2. Update `src/export/index.ts`:
   - Add re-export of exportDesignDNA, ExportResult, ExportInput, generateExportSummary from export-orchestrator.ts

3. Update `src/index.ts`:
   - Add `export * from './export/index.js';` in Phase 5 section
  </action>
  <verify>
    - `npx tsc --noEmit --skipLibCheck` passes (0 errors)
    - exportDesignDNA function is importable from main package
  </verify>
  <done>
    - exportDesignDNA generates all 11+ files in one call
    - Files written to .uidna/exports/ directory structure
    - ExportResult contains file map and summary
    - Export module integrated into src/index.ts barrel
  </done>
</task>

<task type="auto">
  <name>Task 2: Write unit tests for export generators</name>
  <files>
    tests/export/export.test.ts
  </files>
  <action>
Create `tests/export/export.test.ts` using Vitest:

**Test fixture:** Create a minimal but realistic mock data set:
- NormalizationResult with 3 colors, 2 typography tokens, 3 spacing tokens, 1 radius, 1 shadow, 1 motion token (use fixture data similar to Phase 2-3 test patterns)
- AggregatedComponent[] with 2 components (button and card) with canonical styles and variants
- StoredPattern[] with 1 flow pattern
- ContentStyleResult with voice pattern, capitalization pattern, CTA hierarchy, error pattern
- EvidenceIndex with 3 entries

**Test suites:**

1. **Evidence linker tests (3-4 tests):**
   - formatEvidenceCitation with 1 evidence item -> shows single path
   - formatEvidenceCitation with 5 items -> shows 3 paths + "+2 more"
   - formatEvidenceSummary returns correct counts
   - formatEvidenceForJSON strips computedStyles

2. **Semantic namer tests (4-5 tests):**
   - generateSemanticColorName classifies gray as neutral
   - generateSemanticColorName picks most frequent saturated color as primary
   - generateSemanticTypographyName returns heading-1 for largest
   - generateSemanticSpacingName returns xs, sm, md scale
   - generateTokenVarName prepends --

3. **CSS vars tests (2-3 tests):**
   - Output contains `:root {`
   - Output contains `--color-primary:` (or similar semantic name)
   - Output contains all token type sections (colors, typography, spacing, radii, shadows, motion)

4. **Tailwind config tests (2-3 tests):**
   - Output contains `module.exports =`
   - Output contains `theme: {` and `extend: {`
   - Output contains color, fontSize, spacing keys

5. **Figma tokens tests (2-3 tests):**
   - Output parses as valid JSON
   - Parsed output has `$type` and `$value` for color tokens
   - Tokens grouped by type (color, typography, spacing)

6. **JSON layers tests (3-4 tests):**
   - tokens.json has `quick` and `rich` properties
   - Quick layer has string values, rich layer has evidence arrays
   - components.json quick layer has type and variantCount
   - content_style.json quick layer has voice.tone

7. **Report tests (2-3 tests):**
   - Brand DNA Report contains "# Brand DNA Report"
   - Brand DNA Report contains "## Design Tokens" and "## Component Catalog"
   - Content Style Guide contains "# Content Style Guide" and "## Voice & Tone"

8. **Stub generator tests (2-3 tests):**
   - Button stub contains `<button` and `var(--`
   - Stub contains `<style>` block
   - generateAllStubs returns Map with correct component types

All tests use fixture data only — no file I/O, no network, no API keys.
  </action>
  <verify>
    - `npx vitest run tests/export/export.test.ts` — All tests pass
    - `npx tsc --noEmit --skipLibCheck` passes (0 errors)
  </verify>
  <done>
    - ~20-25 unit tests covering all export generators
    - Tests use mock fixture data matching real type structures
    - All tests pass without external dependencies (no network, no API keys)
    - Tests verify output structure, not exact content (resilient to formatting changes)
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit --skipLibCheck` — Zero TypeScript errors
- `npx vitest run tests/export/export.test.ts` — All tests pass
- Export module integrated into main barrel (src/index.ts)
- exportDesignDNA produces all expected files
</verification>

<success_criteria>
- exportDesignDNA generates: 3 format files, 5 JSON files, N component stubs, 2 report documents
- All files written to organized .uidna/exports/ directory structure
- Unit tests pass for all generators (evidence linker, semantic namer, CSS vars, Tailwind, Figma, JSON layers, reports, stubs)
- Export module fully integrated into src/index.ts
- No TypeScript compilation errors
- All tests run without external dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/05-export-reporting/05-06-SUMMARY.md`
</output>
