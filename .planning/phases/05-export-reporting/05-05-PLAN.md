---
phase: 05-export-reporting
plan: 05
type: execute
wave: 3
depends_on: ["05-01", "05-02"]
files_modified:
  - src/export/reports/brand-dna-report.ts
  - src/export/reports/content-style-guide.ts
  - src/export/reports/index.ts
autonomous: true

must_haves:
  truths:
    - "Brand DNA Report is a Markdown document with token tables, usage examples, component catalog, and inline evidence"
    - "Content Style Guide is a separate Markdown document covering voice/tone, CTA rules, error grammar"
    - "Token tables show values plus usage examples (code snippets showing application)"
    - "Component catalog is inline within the Brand DNA Report (not a separate document)"
    - "Evidence citations are inline, showing source pages where tokens/components were observed"
  artifacts:
    - path: "src/export/reports/brand-dna-report.ts"
      provides: "Markdown Brand DNA Report generation"
      exports: ["generateBrandDNAReport"]
    - path: "src/export/reports/content-style-guide.ts"
      provides: "Separate content style guide Markdown document"
      exports: ["generateContentStyleGuide"]
    - path: "src/export/reports/index.ts"
      provides: "Reports barrel export"
  key_links:
    - from: "src/export/reports/brand-dna-report.ts"
      to: "src/export/reports/markdown-utils.ts"
      via: "Table and code block generation"
      pattern: "import.*generateTable"
    - from: "src/export/reports/brand-dna-report.ts"
      to: "src/export/evidence-linker.ts"
      via: "Inline evidence citations"
      pattern: "import.*formatEvidenceCitation"
    - from: "src/export/reports/brand-dna-report.ts"
      to: "src/export/semantic-namer.ts"
      via: "Token names in tables and examples"
      pattern: "import.*generateSemantic"
---

<objective>
Generate the human-readable Brand DNA Report and separate Content Style Guide as Markdown documents.

Purpose: Per user decision, the primary audience is Claude agents and developers. The Brand DNA Report includes token tables with usage examples, an inline component catalog, pattern documentation, and inline evidence citations. The Content Style Guide is a separate standalone document covering voice/tone, CTA rules, capitalization, and error grammar.

Output: `src/export/reports/brand-dna-report.ts` and `content-style-guide.ts`.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-export-reporting/05-RESEARCH.md
@.planning/phases/05-export-reporting/05-CONTEXT.md
@.planning/phases/05-export-reporting/05-01-SUMMARY.md
@.planning/phases/05-export-reporting/05-02-SUMMARY.md
@src/types/normalized-tokens.ts
@src/types/components.ts
@src/types/patterns.ts
@src/types/content-style.ts
@src/components/component-aggregator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Brand DNA Report generator</name>
  <files>
    src/export/reports/brand-dna-report.ts
  </files>
  <action>
Create `src/export/reports/brand-dna-report.ts`:

`generateBrandDNAReport(params: { tokens: NormalizationResult, components: AggregatedComponent[], patterns: StoredPattern[], metadata: { sourceUrl: string, crawlDate: string, totalPages: number } }): string`

**Report structure (Claude's discretion on ordering — using this structure):**

```markdown
# Brand DNA Report

> Design system extracted from [sourceUrl] on [crawlDate]
> Pages analyzed: [totalPages]

## Overview

Brief summary: N color tokens, N typography tokens, N spacing tokens, N components detected, N interaction patterns found.

## Design Tokens

### Colors

[Table: Token Name | Value | Occurrences | Pages | Evidence]

**Usage Example:**
```css
.primary-button {
  background-color: var(--color-primary);
  color: var(--neutral-1);
}
```

### Typography

[Table: Token Name | Font Family | Size | Weight | Line Height | Evidence]

**Usage Example:**
```css
h1 {
  font-family: var(--heading-1-family);
  font-size: var(--heading-1-size);
  font-weight: var(--heading-1-weight);
  line-height: var(--heading-1-line-height);
}
```

### Spacing

[Table: Token Name | Value (px) | Context | Evidence]

### Border Radius

[Table: Token Name | Value | Evidence]

### Shadows

[Table: Token Name | Value | Evidence]

### Motion

[Table: Token Name | Property | Value | Evidence]

## Component Catalog

### [ComponentType] (e.g., Button)

**Detection Summary:** Found on N pages, N instances, confidence: high/medium/low

**Canonical Styles:**
[Table of key CSS properties and their canonical values]

**Variants:**
- Size: small | medium | large (if detected)
- Emphasis: primary | secondary | tertiary | ghost (if detected)

**States:** hover, focus, active, disabled (if detected)

**Evidence:** (parenthetical citation of first 3 pages)

[Repeat for each component type]

## Interaction Patterns

### [FlowType] Flow

**Confidence:** [0-1]
**Path:** page1 → page2 → page3
**Steps:** [stepCount]
**Characteristics:**
- Has form submission: yes/no
- Requires auth: yes/no

**Evidence:** (pages where flow was detected)

[Repeat for each detected flow]

## Export Files

List of all generated export files with descriptions:
- `tokens.css` — CSS custom properties
- `tailwind.config.js` — Tailwind v3 configuration
- `figma-tokens.json` — Figma tokens plugin format
- `tokens.json` — Machine-readable tokens (dual-layer)
- `components.json` — Component catalog
- `patterns.json` — Interaction patterns
- `content_style.json` — Content style rules
- `evidence_index.json` — Full evidence index
- `stubs/[component].html` — Component starter files

---
*Generated by UIUX-Mirror*
```

**Implementation details:**
- Use `generateTable` from markdown-utils for all tables.
- Use `codeBlock` from markdown-utils for CSS usage examples.
- Use `formatEvidenceCitation` from evidence-linker for inline evidence.
- Use semantic names from semantic-namer for all token references in tables and examples.
- For components: iterate AggregatedComponent[], convert Set<string> pageUrls to array for count, extract variant dimensions, list state names.
- For patterns: iterate StoredPattern[], group by type (flow patterns only in this report — content patterns go to content-style-guide.md).
- Keep tables under 100 rows per section — if more tokens exist, show top N by confidence and note "N more tokens in tokens.json".
- Evidence citations: first 3 source paths + "+N more" format.
  </action>
  <verify>
    - `npx tsc --noEmit --skipLibCheck` passes (0 errors)
    - generateBrandDNAReport compiles with correct parameter types
  </verify>
  <done>
    - Brand DNA Report has sections: Overview, Design Tokens (6 types), Component Catalog, Interaction Patterns, Export Files
    - Token tables show name, value, occurrences, evidence
    - Usage examples show CSS code snippets with var() references
    - Component catalog is inline with variants, states, and evidence
    - Evidence citations are parenthetical inline format
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Content Style Guide and reports barrel</name>
  <files>
    src/export/reports/content-style-guide.ts
    src/export/reports/index.ts
    src/export/index.ts
  </files>
  <action>
1. Create `src/export/reports/content-style-guide.ts`:

`generateContentStyleGuide(contentResult: ContentStyleResult, metadata: { sourceUrl: string, crawlDate: string }): string`

**Document structure (separate from Brand DNA Report, per user decision):**

```markdown
# Content Style Guide

> Extracted from [sourceUrl] on [crawlDate]
> Based on [totalSamples] text samples analyzed

## Voice & Tone

**Primary voice pattern:**
- Tone: [formal/casual/professional/friendly/urgent]
- Tense: [imperative/present/future]
- Perspective: [first-person/second-person/third-person]
- Confidence: [high/medium/low]

**Examples:**
> "[example text 1]"
> "[example text 2]"
> "[example text 3]"

[Additional voice patterns if detected, as a table]

## Capitalization Rules

[Table: Context | Style | Examples | Confidence]

Contexts: buttons, links, labels, headings, placeholders, etc.

**Rule Summary:**
- Headings: [style] (e.g., "Title Case")
- Buttons: [style] (e.g., "Sentence case")
- Labels: [style]

## CTA Hierarchy

[Table: Level | Visual Treatment | Usage Contexts | Examples | Frequency]

**Visual Guide:**
- Primary: [solid background, bold text — describe characteristics]
- Secondary: [border only, regular weight]
- Tertiary: [text only, underline]
- Ghost: [transparent background]

## Error Message Grammar

**Primary pattern:** [structure] with [tone]

[Table: Structure | Tone | Examples | Suggests Action? | Frequency]

**Common prefixes:** [list of common error prefixes]

**Recommendations:**
- Use [structure] format for consistency
- Maintain [tone] across all error messages
- [Include/omit] corrective action suggestions

---
*Generated by UIUX-Mirror*
*See also: brand-dna-report.md for design tokens and components*
```

**Implementation details:**
- Use markdown-utils for tables and formatting.
- Pick highest-confidence pattern as "primary" for each category.
- Show up to 5 examples per pattern (from the examples arrays).
- Quote examples using markdown blockquote `>` for visual distinction.
- For capitalization: group by context (buttons, headings, labels, etc.) to show which style applies where.
- For CTA hierarchy: describe visual characteristics in human-readable terms (from CTACharacteristics fields).
- For error grammar: include whether errors suggest corrective action (suggestsAction field).
- Handle empty/missing data gracefully (e.g., "No error patterns detected" if errorPatterns is empty).

2. Create `src/export/reports/index.ts` barrel:
   - Re-export generateBrandDNAReport from brand-dna-report.ts
   - Re-export generateContentStyleGuide from content-style-guide.ts
   - Re-export all from markdown-utils.ts

3. Update `src/export/index.ts`:
   - Add re-export from `./reports/index.js`
  </action>
  <verify>
    - `npx tsc --noEmit --skipLibCheck` passes (0 errors)
    - Both report generators accessible from src/export/index.ts
  </verify>
  <done>
    - Content Style Guide is a separate standalone Markdown document
    - Voice/tone section shows primary pattern with examples
    - Capitalization section maps contexts to styles
    - CTA hierarchy describes visual treatment per level
    - Error grammar section includes structure, tone, and corrective action info
    - Handles empty data gracefully
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit --skipLibCheck` — Zero TypeScript errors
- Brand DNA Report includes all required sections
- Content Style Guide is a separate document (not a section of Brand DNA Report)
- Evidence citations appear inline in Brand DNA Report
- Token tables include usage example code blocks
</verification>

<success_criteria>
- Brand DNA Report has: Overview, Design Tokens (6 types with tables + examples), Component Catalog (inline), Interaction Patterns, Export Files list
- Content Style Guide has: Voice & Tone, Capitalization Rules, CTA Hierarchy, Error Message Grammar
- Both documents have proper Markdown formatting (tables render, code blocks highlight)
- Both reference source URL and crawl date
- Content Style Guide cross-references Brand DNA Report
</success_criteria>

<output>
After completion, create `.planning/phases/05-export-reporting/05-05-SUMMARY.md`
</output>
