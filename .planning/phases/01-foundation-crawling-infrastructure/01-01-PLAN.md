---
phase: 01-foundation-crawling-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/types/tokens.ts
  - src/types/evidence.ts
  - src/types/crawl-config.ts
  - src/types/index.ts
  - src/shared/logger.ts
  - src/shared/config.ts
  - src/shared/errors.ts
  - src/shared/utils.ts
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Project compiles with zero errors via tsc --noEmit"
    - "All Phase 1 data types are defined with strict TypeScript interfaces"
    - "Shared utilities (logger, config, errors) are importable from any module"
  artifacts:
    - path: "package.json"
      provides: "Node.js project manifest with all Phase 1 dependencies"
      contains: "crawlee"
    - path: "tsconfig.json"
      provides: "TypeScript configuration targeting ES2022 ESM"
      contains: "ESNext"
    - path: "src/types/tokens.ts"
      provides: "Token type definitions for all 8 categories"
      exports: ["ColorToken", "TypographyToken", "SpacingToken", "RadiusToken", "ShadowToken", "ZIndexToken", "MotionToken", "IconToken", "ImageryToken"]
    - path: "src/types/evidence.ts"
      provides: "Evidence and observation type definitions"
      exports: ["TokenEvidence", "EvidenceEntry", "EvidenceIndex"]
    - path: "src/types/crawl-config.ts"
      provides: "Crawl configuration and page data types"
      exports: ["CrawlConfig", "PageData", "CrawlResult"]
    - path: "src/shared/config.ts"
      provides: "Configuration loader with defaults"
      exports: ["loadConfig", "defaultConfig"]
  key_links:
    - from: "src/types/tokens.ts"
      to: "src/types/evidence.ts"
      via: "TokenEvidence referenced in all token types"
      pattern: "evidence:\\s*TokenEvidence"
    - from: "src/shared/config.ts"
      to: "src/types/crawl-config.ts"
      via: "config loader returns CrawlConfig"
      pattern: "CrawlConfig"
---

<objective>
Scaffold the UIUX-Mirror project from scratch and define all TypeScript types and shared utilities needed by Phase 1.

Purpose: Establish the project foundation -- package.json, TypeScript config, core type definitions for tokens/evidence/config, and shared utilities (logger, config loader, error classes). All subsequent plans depend on these types and utilities existing.

Output: A compilable TypeScript project with all Phase 1 type contracts defined, dependencies installed, and shared utilities ready for import.
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:/Users/Karl/UIUX-Mirror/.planning/PROJECT.md
@C:/Users/Karl/UIUX-Mirror/.planning/ROADMAP.md
@C:/Users/Karl/UIUX-Mirror/.planning/phases/01-foundation-crawling-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize project with package.json, tsconfig.json, and install dependencies</name>
  <files>package.json, tsconfig.json, .gitignore</files>
  <action>
Initialize the UIUX-Mirror project in the repo root (C:/Users/Karl/UIUX-Mirror/).

1. Create package.json with:
   - name: "uiux-mirror", version: "0.1.0"
   - "type": "module" (ESM-only)
   - scripts: dev (tsx src/index.ts), build (tsup src/index.ts --format esm --clean), test (vitest), lint (eslint src/)
   - bin: { "uidna": "./dist/index.js" }
   - engines: { "node": ">=20.0.0" }

2. Run npm install for core deps:
   - playwright, crawlee, @crawlee/playwright (crawler infrastructure)
   - playwright-extra, puppeteer-extra-plugin-stealth (anti-bot)
   - robots-parser (robots.txt compliance)
   - lowdb (file-based JSON storage)
   - fs-extra (atomic file ops)
   - zod (schema validation)
   - color (color normalization)

3. Run npm install -D for dev deps:
   - typescript, tsx, tsup (build chain)
   - vitest (testing)
   - @types/node, @types/fs-extra

4. Create tsconfig.json:
   - target: "ES2022", module: "ESNext", moduleResolution: "bundler"
   - strict: true, esModuleInterop: true, skipLibCheck: true
   - resolveJsonModule: true, outDir: "./dist", rootDir: "./src"
   - types: ["node"]
   - include: ["src/**/*"], exclude: ["node_modules", "dist"]

5. Create .gitignore with: node_modules/, dist/, .uidna/, *.tsbuildinfo, .env

6. Run npx playwright install chromium (install browser binary)
  </action>
  <verify>
Run `cd C:/Users/Karl/UIUX-Mirror && npx tsc --noEmit` -- should succeed (no .ts files yet, but config valid).
Run `node -e "require('./package.json')"` -- should parse without error.
Verify node_modules exists and key packages are installed: `ls node_modules/playwright node_modules/crawlee node_modules/zod`
  </verify>
  <done>package.json has all Phase 1 dependencies, tsconfig.json compiles ESM TypeScript, Playwright chromium browser is installed</done>
</task>

<task type="auto">
  <name>Task 2: Define all Phase 1 TypeScript types (tokens, evidence, config)</name>
  <files>src/types/tokens.ts, src/types/evidence.ts, src/types/crawl-config.ts, src/types/index.ts</files>
  <action>
Create the type definition files that serve as contracts between all Phase 1 modules.

1. src/types/tokens.ts -- Design token types for all 8 TOKEN requirements:

```typescript
// TOKEN-01: Color tokens
interface ColorToken {
  value: string;              // Normalized hex (#rrggbb)
  originalValue: string;      // As extracted (rgb, hsl, etc.)
  category: 'primary' | 'secondary' | 'accent' | 'neutral' | 'semantic' | 'unknown';
  context: 'background' | 'text' | 'border' | 'accent' | 'other';
  evidence: TokenEvidence[];
}

// TOKEN-02: Typography tokens
interface TypographyToken {
  family: string;
  size: string;               // e.g. "16px" or "1rem"
  sizePixels: number;         // Always in px for comparison
  weight: number;             // 100-900
  lineHeight: string;
  letterSpacing: string;
  evidence: TokenEvidence[];
}

// TOKEN-03: Spacing tokens
interface SpacingToken {
  value: string;              // Original value
  valuePixels: number;        // Normalized to px
  context: 'margin' | 'padding' | 'gap';
  evidence: TokenEvidence[];
}

// TOKEN-04: CSS Custom Property tokens
interface CustomPropertyToken {
  name: string;               // --primary-color
  value: string;              // resolved value
  rawValue: string;           // may contain var() references
  category: 'color' | 'typography' | 'spacing' | 'radius' | 'shadow' | 'motion' | 'other';
  evidence: TokenEvidence[];
}

// TOKEN-05: Border radius, shadow, z-index
interface RadiusToken { value: string; valuePixels: number; evidence: TokenEvidence[]; }
interface ShadowToken { value: string; layers: ShadowLayer[]; evidence: TokenEvidence[]; }
interface ShadowLayer { offsetX: string; offsetY: string; blur: string; spread: string; color: string; inset: boolean; }
interface ZIndexToken { value: number; stackingContext: string; evidence: TokenEvidence[]; }

// TOKEN-06: Motion/animation tokens
interface MotionToken {
  property: 'duration' | 'easing' | 'keyframe';
  value: string;
  durationMs?: number;        // Normalized to ms
  evidence: TokenEvidence[];
}

// TOKEN-07: Icon tokens
interface IconToken {
  style: 'stroke' | 'fill' | 'mixed';
  strokeWeight?: number;
  sizePixels: number;
  format: 'svg-inline' | 'svg-img' | 'icon-font' | 'img';
  evidence: TokenEvidence[];
}

// TOKEN-08: Imagery tokens
interface ImageryToken {
  aspectRatio: string;        // e.g. "16:9"
  treatment: 'rounded' | 'circular' | 'rectangular' | 'masked';
  objectFit: string;
  evidence: TokenEvidence[];
}

// Union type for all tokens
type DesignToken = ColorToken | TypographyToken | SpacingToken | CustomPropertyToken |
                   RadiusToken | ShadowToken | ZIndexToken | MotionToken | IconToken | ImageryToken;
```

Also define a `PageTokens` interface that groups all token types extracted from a single page.

2. src/types/evidence.ts -- Evidence types for NORM-03:

```typescript
interface TokenEvidence {
  pageUrl: string;
  selector: string;
  timestamp: string;          // ISO 8601
  screenshotPath?: string;    // Relative path to screenshot crop
  computedStyles: Record<string, string>;
  boundingBox?: { x: number; y: number; width: number; height: number };
}

interface EvidenceEntry {
  id: string;                 // SHA-256 hash of pageUrl + selector + timestamp
  pageUrl: string;
  selector: string;
  timestamp: string;
  screenshotPath?: string;
  computedStyles: Record<string, string>;
  boundingBox?: { x: number; y: number; width: number; height: number };
}

interface EvidenceIndex {
  entries: Record<string, EvidenceEntry>;
  byPage: Record<string, string[]>;      // pageUrl -> evidenceId[]
  bySelector: Record<string, string[]>;   // selector -> evidenceId[]
}
```

3. src/types/crawl-config.ts -- Configuration and crawl result types:

```typescript
interface CrawlConfig {
  seedUrls: string[];
  maxDepth: number;           // default 3
  maxPages: number;           // default 100
  domainAllowlist?: string[];
  respectRobotsTxt: boolean;  // default true (strict mode)
  maxConcurrency: number;     // default 5
  maxRequestsPerMinute: number; // default 60
  timingJitterMs: [number, number]; // default [100, 500] min/max jitter
  userAgents: string[];       // rotation list
  viewportSizes: Array<{ width: number; height: number }>;
  waitStrategies: WaitStrategy[];
  outputDir: string;          // default '.uidna'
}

type WaitStrategy = 'networkidle' | 'framework-hydration' | 'css-injection' | 'custom-delay';

interface PageData {
  url: string;
  finalUrl: string;           // after redirects
  statusCode: number;
  title: string;
  timestamp: string;
  framework: 'react' | 'vue' | 'angular' | 'svelte' | 'unknown';
  cssInJsLibrary: 'emotion' | 'styled-components' | 'stitches' | 'none';
  htmlContent: string;
  screenshotPath?: string;    // full page screenshot
}

interface CrawlResult {
  config: CrawlConfig;
  startTime: string;
  endTime: string;
  pagesProcessed: number;
  pagesFailed: number;
  pagesSkipped: number;       // robots.txt blocked
  pages: PageData[];
}

interface CrawlSnapshot {
  timestamp: string;
  configHash: string;
  tokenHashes: Record<string, string>;  // pageUrl -> hash of extracted tokens
  totalPages: number;
}

interface DiffResult {
  previousSnapshot: CrawlSnapshot;
  currentSnapshot: CrawlSnapshot;
  added: string[];            // new page URLs
  removed: string[];          // removed page URLs
  changed: string[];          // pages with changed tokens
  unchanged: string[];
}
```

4. src/types/index.ts -- Re-export everything:
Export all types from tokens.ts, evidence.ts, and crawl-config.ts as a barrel file.

Make all interfaces exported. Use `export type` for type-only exports where appropriate.
  </action>
  <verify>Run `cd C:/Users/Karl/UIUX-Mirror && npx tsc --noEmit` -- should compile with zero errors</verify>
  <done>All 8 token type categories defined, evidence types defined with NORM-03 fields (pageUrl, selector, timestamp, screenshot, computedStyles), config types defined with all CRAWL requirements reflected</done>
</task>

<task type="auto">
  <name>Task 3: Create shared utilities (logger, config loader, error classes, helpers)</name>
  <files>src/shared/logger.ts, src/shared/config.ts, src/shared/errors.ts, src/shared/utils.ts, src/shared/index.ts, src/index.ts</files>
  <action>
Create shared utilities that all Phase 1 modules will import.

1. src/shared/logger.ts -- Simple structured logger (no external dependency):
   - Create a Logger class with methods: info, warn, error, debug
   - Include timestamp, level, and optional context (module name) in output
   - Support log level configuration via environment variable LOG_LEVEL (default: 'info')
   - Use console.log/warn/error (keep it simple for v1, no Winston/Pino)
   - Export a createLogger(moduleName: string) factory function

2. src/shared/config.ts -- Configuration loader:
   - Export defaultConfig: CrawlConfig with sensible defaults from research:
     maxDepth: 3, maxPages: 100, respectRobotsTxt: true, maxConcurrency: 5,
     maxRequestsPerMinute: 60, timingJitterMs: [100, 500],
     userAgents: [5 realistic Chrome user-agent strings],
     viewportSizes: [{ width: 1920, height: 1080 }, { width: 1366, height: 768 }],
     waitStrategies: ['networkidle', 'framework-hydration', 'css-injection'],
     outputDir: '.uidna'
   - Export loadConfig(overrides?: Partial<CrawlConfig>): CrawlConfig that deep-merges overrides with defaults
   - Use zod schema to validate merged config

3. src/shared/errors.ts -- Custom error classes:
   - CrawlError (url, statusCode, message) -- for crawl failures
   - ExtractionError (url, selector, message) -- for extraction failures
   - RobotsBlockedError (url) -- when robots.txt disallows
   - ConfigValidationError (field, message) -- invalid config
   - All extend a base UidnaError class with a code property

4. src/shared/utils.ts -- Common helpers:
   - generateEvidenceId(pageUrl: string, selector: string, timestamp: string): string -- SHA-256 hash
   - normalizeUrl(url: string): string -- strip trailing slash, normalize protocol
   - sanitizeFilename(url: string): string -- convert URL to safe filename
   - sleep(ms: number): Promise<void>
   - randomJitter(min: number, max: number): number -- random ms between min and max
   - hashTokens(tokens: any): string -- deterministic hash for diff detection

5. src/shared/index.ts -- Barrel re-export of all shared modules.

6. src/index.ts -- Top-level entry point (placeholder for now):
   - Export types from src/types/index.ts
   - Export shared utilities from src/shared/index.ts
   - Add a comment: "// Crawler, extractors, and evidence modules added in subsequent plans"
  </action>
  <verify>
Run `cd C:/Users/Karl/UIUX-Mirror && npx tsc --noEmit` -- should compile with zero errors.
Run `cd C:/Users/Karl/UIUX-Mirror && npx tsx -e "import { createLogger, loadConfig, CrawlError } from './src/shared/index.js'; console.log('OK')"` -- should print OK.
  </verify>
  <done>Logger creates contextual loggers per module, config loader validates and merges with defaults, error classes cover all Phase 1 failure modes, utility functions for hashing/URL normalization/jitter are ready</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. All type files export their interfaces: `npx tsx -e "import * as T from './src/types/index.js'; console.log(Object.keys(T))"`
3. Shared utilities are importable: `npx tsx -e "import { createLogger, loadConfig } from './src/shared/index.js'; const log = createLogger('test'); log.info('works'); const cfg = loadConfig(); console.log(cfg.maxPages)"`
4. package.json has all required dependencies installed
5. Playwright chromium is available: `npx playwright --version`
</verification>

<success_criteria>
- TypeScript project compiles cleanly with strict mode
- All 8 token type categories have exported interfaces
- Evidence types include all NORM-03 fields (pageUrl, selector, timestamp, screenshot, computedStyles)
- CrawlConfig reflects all configurable parameters from CRAWL requirements
- Shared utilities (logger, config, errors, helpers) work when imported
- All Phase 1 dependencies installed and importable
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-crawling-infrastructure/01-01-SUMMARY.md`
</output>
