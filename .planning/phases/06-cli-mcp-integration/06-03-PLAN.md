---
phase: 06-cli-mcp-integration
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/cli/commands/report.ts
  - src/cli/commands/synth.ts
  - src/cli/commands/export.ts
autonomous: true

must_haves:
  truths:
    - "User can run `uidna report` to generate Brand DNA Report and Content Style Guide"
    - "User can run `uidna synth <component>` to synthesize a new component using extracted design DNA"
    - "User can run `uidna export` with --format flag to export tokens in css/tailwind/figma/json formats"
  artifacts:
    - path: "src/cli/commands/report.ts"
      provides: "Report generation command"
      exports: ["reportCommand"]
    - path: "src/cli/commands/synth.ts"
      provides: "Component synthesis command"
      exports: ["synthCommand"]
    - path: "src/cli/commands/export.ts"
      provides: "Multi-format export command"
      exports: ["exportCommand"]
  key_links:
    - from: "src/cli/commands/report.ts"
      to: "src/export/reports/index.ts"
      via: "calls generateBrandDNAReport and generateContentStyleGuide"
      pattern: "import.*generateBrandDNA"
    - from: "src/cli/commands/synth.ts"
      to: "src/synthesis/component-composer.ts"
      via: "calls synthesizeComponent"
      pattern: "import.*synthesizeComponent"
    - from: "src/cli/commands/export.ts"
      to: "src/export/export-orchestrator.ts"
      via: "calls exportDesignDNA for full export or individual format generators"
      pattern: "import.*exportDesignDNA"
---

<objective>
Implement the report, synth, and export CLI commands -- the three output-producing commands that generate human and machine-readable outputs from extracted design DNA.

Purpose: These commands let users generate reports, synthesize new components, and export design tokens in various formats.
Output: Working report, synth, and export commands with progress feedback
</objective>

<execution_context>
@C:/Users/Karl/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Karl/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-cli-mcp-integration/06-RESEARCH.md
@.planning/phases/06-cli-mcp-integration/06-01-SUMMARY.md
@src/export/export-orchestrator.ts
@src/export/reports/index.ts
@src/synthesis/component-composer.ts
@src/synthesis/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement report and synth commands</name>
  <files>src/cli/commands/report.ts, src/cli/commands/synth.ts, src/cli.ts</files>
  <action>
**Create `src/cli/commands/report.ts`:**

Export `reportCommand(args: string[])` async function:

1. Parse flags:
   - `--output-dir <dir>` (string, optional)
   - `--help` (print report help and exit)

2. Load config via `loadFullConfig({})`.

3. Verify extracted data exists: Check for normalized token data in outputDir. If not found, print "No extracted data found. Run `uidna extract` first." and exit(1).

4. Load extracted data: Read normalized tokens, components, patterns, content style, evidence index from .uidna/ JSON files (tokens.json, components.json, etc. -- the output from extract command).

5. Generate reports using `withProgress`:
   - "Generating Brand DNA Report..." -> call `generateBrandDNAReport()`
   - "Generating Content Style Guide..." -> call `generateContentStyleGuide()`

6. Write reports to outputDir (brand-dna-report.md, content-style-guide.md).

7. Print summary: report file paths, file sizes.

8. Help text:
   ```
   Usage: uidna report [options]

   Generate Brand DNA Report and Content Style Guide from extracted data.

   Options:
     --output-dir <dir>  Output directory (default: .uidna/exports)
   ```

**Create `src/cli/commands/synth.ts`:**

Export `synthCommand(args: string[])` async function:

1. Parse args:
   - First non-flag arg = component type (required, e.g., "data-table", "modal", "card")
   - `--output-dir <dir>` (string, optional)
   - `--help` (print synth help and exit)

2. If no component type provided, print error "Component type required" with examples and exit(1).

3. Load config, verify extracted data exists (same pattern as report).

4. Load design DNA data from stored files (needs NormalizationResult, components, etc. to build DesignDNA input for synthesizeComponent).

5. Run synthesis using `withProgress`:
   - "Synthesizing {componentType} component..."
   - Call `synthesizeComponent(componentType, designDNA)` from `../../synthesis/component-composer.js`
   - Note: This may call Claude API if ANTHROPIC_API_KEY is set. If not set, LLM refinement is skipped gracefully.

6. Write output: Save synthesized component to outputDir/stubs/{componentType}.html. Also save the JSON metadata (evidence, confidence) to outputDir/stubs/{componentType}.json.

7. Print summary: component type, confidence score, evidence count, output file path, whether LLM refinement was applied.

8. Help text:
   ```
   Usage: uidna synth <component-type> [options]

   Synthesize a new component using extracted design DNA.

   Examples:
     uidna synth data-table
     uidna synth modal
     uidna synth card

   Options:
     --output-dir <dir>  Output directory (default: .uidna/exports)
   ```

Update `src/cli.ts` to wire the `report` and `synth` cases with dynamic imports.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. Run `npx tsx src/cli.ts report --help` and `npx tsx src/cli.ts synth --help` to see help text. Run `npx tsx src/cli.ts synth` (no type) to see error about missing component type.</verify>
  <done>Report command generates Brand DNA Report and Content Style Guide. Synth command synthesizes components with evidence tracing.</done>
</task>

<task type="auto">
  <name>Task 2: Implement export command</name>
  <files>src/cli/commands/export.ts, src/cli.ts</files>
  <action>
**Create `src/cli/commands/export.ts`:**

Export `exportCommand(args: string[])` async function:

1. Parse flags:
   - `--format <fmt>` (string, repeatable: "tokens", "figma", "tailwind", "cssvars", "json", "all"). Default: "all"
   - `--output-dir <dir>` (string, optional, default ".uidna/exports")
   - `--help` (print export help and exit)

2. Validate format values. If unknown format provided, list valid options and exit(1).

3. Load config, verify extracted data exists.

4. Load design DNA data from stored files (same pattern as report/synth).

5. If format is "all" or multiple formats:
   - Use `exportDesignDNA()` from `../../export/export-orchestrator.js` with full ExportInput
   - This generates all formats, JSON exports, stubs, and reports in one call
   - Use `withProgress`: "Exporting design DNA..."

6. If specific format(s):
   - Call individual generators based on format flag:
     - "cssvars" -> `generateCSSCustomProperties(tokens)` -> write formats/tokens.css
     - "tailwind" -> `generateTailwindConfig(tokens)` -> write formats/tailwind.config.js
     - "figma" -> `generateFigmaTokens(tokens)` -> write formats/figma-tokens.json
     - "json" -> all JSON generators (tokens, components, patterns, content_style, evidence_index)
     - "tokens" -> alias for "json" (machine-readable token exports)
   - Use `withProgress` per generator

7. Print summary using `generateExportSummary()` from export-orchestrator. Show: files generated, output paths, total file count.

8. Help text:
   ```
   Usage: uidna export [options]

   Export design tokens in various formats.

   Options:
     --format <fmt>      Export format (repeatable): tokens, figma, tailwind, cssvars, json, all
                         Default: all
     --output-dir <dir>  Output directory (default: .uidna/exports)

   Examples:
     uidna export                          Export all formats
     uidna export --format tailwind        Export Tailwind config only
     uidna export --format cssvars --format figma  Export CSS vars and Figma tokens
   ```

Update `src/cli.ts` to wire the `export` case with dynamic import.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. Run `npx tsx src/cli.ts export --help` to see export help. Run `npx tsx src/cli.ts export --format unknown` to see valid format error.</verify>
  <done>Export command supports all format flags, calls the appropriate generators, and writes output files with summary.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `uidna report --help` shows report help
- `uidna synth --help` shows synth help with examples
- `uidna synth` (no type) shows error about missing component type
- `uidna export --help` shows export help with format options
- `uidna export --format unknown` shows invalid format error
- All commands check for extracted data before proceeding
</verification>

<success_criteria>
- report command generates Brand DNA Report and Content Style Guide
- synth command synthesizes components with evidence tracing and confidence scores
- export command supports all 5 formats individually or all at once
- All commands provide clear error messages when preconditions not met
</success_criteria>

<output>
After completion, create `.planning/phases/06-cli-mcp-integration/06-03-SUMMARY.md`
</output>
